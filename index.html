<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/service-worker.js");
      });
    }
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gym Log Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f1f5f9; user-select: none; -webkit-tap-highlight-color: transparent; }
        .tap-active:active { transform: scale(0.95); opacity: 0.8; }
        /* Hide arrows in number input */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="pb-32">

    <!-- Header -->
    <div class="bg-slate-900 border-b border-slate-800 sticky top-0 z-30 shadow-xl">
        <div class="flex items-center justify-between p-4">
            <h1 class="font-bold text-white flex items-center gap-2 text-lg">
                <span class="bg-blue-600 p-1 rounded">üí™</span> Gym Log
            </h1>
            <button onclick="exportData()" class="p-2 bg-slate-800 rounded-full text-slate-400 border border-slate-700">‚¨áÔ∏è</button>
        </div>
        
        <!-- Date Nav -->
        <div class="bg-slate-800/90 backdrop-blur border-t border-slate-700/50 flex justify-between px-4 py-3 items-center">
            <button onclick="changeDate(-1)" class="p-2 text-2xl text-slate-300 w-12">‚Äπ</button>
            <div class="text-center">
                <div id="dayNameDisplay" class="text-xs text-blue-400 font-bold uppercase tracking-wider"></div>
                <div id="dateDisplay" class="text-xl font-bold text-white"></div>
            </div>
            <button onclick="changeDate(1)" class="p-2 text-2xl text-slate-300 w-12">‚Ä∫</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="p-4 max-w-2xl mx-auto space-y-4" id="app"></div>

    <!-- 1. Plan Change Modal -->
    <div id="planModal" class="hidden fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-sm rounded-2xl p-6 border border-slate-700">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Change Plan</h3>
                <button onclick="togglePlanModal(false)" class="text-slate-400 text-2xl p-2">‚úï</button>
            </div>
            <div class="space-y-3">
                <button onclick="setRoutine('A')" class="w-full p-4 rounded-xl text-left bg-slate-700 text-white border border-slate-600 active:bg-blue-600">
                    <b class="text-lg">Back + Biceps</b>
                </button>
                <button onclick="setRoutine('B')" class="w-full p-4 rounded-xl text-left bg-slate-700 text-white border border-slate-600 active:bg-red-600">
                    <b class="text-lg">Shoulders + Legs</b>
                </button>
                <button onclick="setRoutine('C')" class="w-full p-4 rounded-xl text-left bg-slate-700 text-white border border-slate-600 active:bg-green-600">
                    <b class="text-lg">Chest + Triceps</b>
                </button>
                <button onclick="setRoutine('REST')" class="w-full p-4 rounded-xl text-left bg-slate-700 text-white border border-slate-600 active:bg-gray-600">
                    <b class="text-lg">Rest Day</b>
                </button>
            </div>
        </div>
    </div>

    <!-- 2. Rename Exercise Modal -->
    <div id="renameModal" class="hidden fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-xs rounded-2xl p-6 border border-slate-700 shadow-2xl">
            <h3 class="text-lg font-bold text-white mb-4">Rename Exercise</h3>
            <input type="text" id="renameInput" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white mb-4 focus:border-blue-500 outline-none" placeholder="e.g. Pushups">
            <div class="flex gap-3">
                <button onclick="closeRenameModal()" class="flex-1 p-3 rounded-lg bg-slate-700 text-slate-300 font-bold">Cancel</button>
                <button onclick="saveRename()" class="flex-1 p-3 rounded-lg bg-blue-600 text-white font-bold">Save</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        let currentDate = new Date();
        // Updated key to V3 to ensure fresh structure for new fields
        let logs = JSON.parse(localStorage.getItem('gymTrackerLogsV3')) || {};
        let currentEditingIndex = null; 

        const DEFAULTS = {
            'A': ["Lat Pulldown", "Seated Rowing", "Deadlift", "Dumbbell Row", "Back Extension", "Barbell Curls", "Dumbbell Curls", "Hammer Curls"],
            'B': ["Shoulder Press", "Lateral Raises", "Front Raises", "Rear Delt Fly", "Shrugs", "Squats", "Leg Press", "Leg Extension", "Leg Curl", "Calf Raises"],
            'C': ["Bench Press", "Incline Press", "Chest Fly", "Push-ups", "Tricep Pushdown", "Skull Crushers", "Overhead Ext", "Dips"]
        };
        
        const TITLES = { 'A': 'Back + Biceps', 'B': 'Shoulders + Legs', 'C': 'Chest + Triceps', 'REST': 'Rest Day' };
        const COLORS = { 'A': 'blue', 'B': 'red', 'C': 'green', 'REST': 'slate' };

        // --- HELPERS ---
        const getFormattedDate = (date) => date.toISOString().split('T')[0];
        const getDayName = (date) => date.toLocaleDateString('en-US', { weekday: 'long' });
        
        function getScheduledRoutine(dayName) {
            if (dayName === "Tuesday") return "A";
            if (dayName === "Thursday") return "B";
            if (dayName === "Saturday") return "C";
            return "REST";
        }

        function saveData() {
            localStorage.setItem('gymTrackerLogsV3', JSON.stringify(logs));
            render();
        }

        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            render();
        }

        // --- MODAL LOGIC ---
        function togglePlanModal(show) {
            document.getElementById('planModal').style.display = show ? 'flex' : 'none';
        }

        function openRenameModal(idx, currentName) {
            currentEditingIndex = idx;
            const input = document.getElementById('renameInput');
            input.value = currentName;
            document.getElementById('renameModal').style.display = 'flex';
            input.focus();
        }

        function closeRenameModal() {
            document.getElementById('renameModal').style.display = 'none';
            currentEditingIndex = null;
        }

        function saveRename() {
            const newName = document.getElementById('renameInput').value;
            if (newName && newName.trim() !== "" && currentEditingIndex !== null) {
                const dateKey = getFormattedDate(currentDate);
                if (!logs[dateKey]) logs[dateKey] = {};
                if (!logs[dateKey][currentEditingIndex]) logs[dateKey][currentEditingIndex] = { sets: [false,false,false,false], weight: '', reps: '' };
                
                logs[dateKey][currentEditingIndex].customName = newName;
                
                if (!logs[dateKey].override) {
                    logs[dateKey].override = getScheduledRoutine(getDayName(currentDate));
                }
                saveData();
            }
            closeRenameModal();
        }

        function setRoutine(type) {
            const dateKey = getFormattedDate(currentDate);
            if (!logs[dateKey]) logs[dateKey] = {};
            logs[dateKey].override = type;
            saveData();
            togglePlanModal(false);
        }

        // --- INTERACTION ---
        function toggleSet(exIdx, setIdx) {
            const dateKey = getFormattedDate(currentDate);
            if (!logs[dateKey]) logs[dateKey] = {};
            if (!logs[dateKey][exIdx]) logs[dateKey][exIdx] = { sets: [false,false,false,false], weight: '', reps: '' };
            
            logs[dateKey][exIdx].sets[setIdx] = !logs[dateKey][exIdx].sets[setIdx];
            
            if (!logs[dateKey].override) logs[dateKey].override = getScheduledRoutine(getDayName(currentDate));
            saveData();
        }

        function saveInput(exIdx, type, val) {
            const dateKey = getFormattedDate(currentDate);
            if (!logs[dateKey]) logs[dateKey] = {};
            if (!logs[dateKey][exIdx]) logs[dateKey][exIdx] = { sets: [false,false,false,false], weight: '', reps: '' };
            
            // Type is either 'weight' or 'reps'
            logs[dateKey][exIdx][type] = val;
            
            if (!logs[dateKey].override) logs[dateKey].override = getScheduledRoutine(getDayName(currentDate));
            
            // We save to localStorage but DON'T re-render to keep focus on input
            localStorage.setItem('gymTrackerLogsV3', JSON.stringify(logs));
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs));
            const a = document.createElement('a');
            a.href = dataStr;
            a.download = "gym_logs.json";
            a.click();
        }

        // --- RENDER ---
        function render() {
            const dayName = getDayName(currentDate);
            const dateKey = getFormattedDate(currentDate);
            
            document.getElementById('dayNameDisplay').innerText = dayName;
            document.getElementById('dateDisplay').innerText = currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

            const log = logs[dateKey] || {};
            const routineId = log.override || getScheduledRoutine(dayName);
            const isRest = routineId === 'REST';
            const color = COLORS[routineId];
            
            const app = document.getElementById('app');
            
            let html = `
                <div class="rounded-2xl p-6 shadow-lg relative overflow-hidden bg-gradient-to-br from-${color}-900 to-slate-900 border border-${color}-700">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <div class="flex gap-2 mb-2">
                                <span class="px-2 py-1 rounded text-[10px] font-bold uppercase bg-${color}-600 text-white shadow">${isRest ? 'Recovery' : 'Workout'}</span>
                                <button onclick="togglePlanModal(true)" class="px-3 py-1 rounded bg-white/10 border border-white/10 text-[10px] font-bold uppercase text-white active:bg-white/20">‚öôÔ∏è Change Plan</button>
                            </div>
                            <h2 class="text-3xl font-bold text-white tracking-tight">${TITLES[routineId]}</h2>
                        </div>
                    </div>
                </div>
            `;

            if (isRest) {
                html += `<div class="text-center py-12 text-slate-500 border-2 border-dashed border-slate-800 rounded-2xl"><div class="text-5xl mb-3">üò¥</div><p class="font-medium">Rest Day</p></div>`;
            } else {
                const defaultExercises = DEFAULTS[routineId];
                
                defaultExercises.forEach((defaultName, idx) => {
                    const exData = log[idx] || { sets: [false,false,false,false], weight: '', reps: '' };
                    const displayName = exData.customName || defaultName;
                    const isDone = exData.sets && exData.sets.every(Boolean);
                    
                    html += `
                        <div class="bg-slate-800 rounded-xl p-4 border ${isDone ? 'border-green-500/50 bg-green-900/10' : 'border-slate-700 shadow-md'}">
                            <div class="flex justify-between mb-4 items-center">
                                <h3 class="font-bold text-lg text-slate-100">${displayName}</h3>
                                <button onclick="openRenameModal(${idx}, '${displayName.replace(/'/g, "\\'")}')" class="text-[10px] font-bold bg-slate-700 text-slate-300 px-2 py-1 rounded border border-slate-600 active:bg-slate-600">‚úé EDIT</button>
                            </div>
                            
                            <div class="flex flex-col gap-4">
                                <div class="flex justify-between items-center bg-slate-900/50 p-2 rounded-lg border border-slate-800">
                                    <span class="text-[10px] text-slate-500 font-bold uppercase mr-2 tracking-wider">Sets</span>
                                    <div class="flex gap-2 flex-1 justify-end">
                                        ${[0,1,2,3].map(s => `
                                            <button onclick="toggleSet(${idx}, ${s})" class="tap-active h-10 flex-1 max-w-[50px] rounded-md font-bold text-base transition-all ${exData.sets && exData.sets[s] ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50 transform scale-105' : 'bg-slate-700 text-slate-400'}">${s+1}</button>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="flex gap-3">
                                    <div class="flex-1">
                                        <label class="text-[10px] text-slate-500 font-bold uppercase ml-1 mb-1 block">Reps</label>
                                        <input type="number" placeholder="0" value="${exData.reps || ''}" onblur="saveInput(${idx}, 'reps', this.value)" class="bg-slate-900 border border-slate-700 text-white text-lg rounded-lg w-full p-3 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-slate-600 font-bold">
                                    </div>
                                    <div class="flex-1">
                                        <label class="text-[10px] text-slate-500 font-bold uppercase ml-1 mb-1 block">Kg / Lbs</label>
                                        <input type="number" placeholder="0" value="${exData.weight || ''}" onblur="saveInput(${idx}, 'weight', this.value)" class="bg-slate-900 border border-slate-700 text-white text-lg rounded-lg w-full p-3 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-slate-600 font-bold">
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            app.innerHTML = html;
        }

        // Init
        render();
    </script>
</body>
</html>


